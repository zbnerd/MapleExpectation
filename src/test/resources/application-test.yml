spring:
  config:
    activate:
      on-profile: test

  datasource:
    url: jdbc:h2:mem:testdb
    driver-class-name: org.h2.Driver
    username: sa
    password:

  jpa:
    hibernate:
      ddl-auto: create-drop
    show-sql: false

  # ğŸ”¥ [Issue #77] í…ŒìŠ¤íŠ¸ í™˜ê²½: Sentinel ë¹„í™œì„±í™”, ë‹¨ì¼ Redis ì‚¬ìš©
  data:
    redis:
      host: localhost
      port: 6379
      # Sentinel ì„¤ì • ì œê±° (í…ŒìŠ¤íŠ¸ëŠ” ë‹¨ì¼ Redis ì‚¬ìš©)

# Issue #202: Resilience4j í…ŒìŠ¤íŠ¸ í™˜ê²½ ì„¤ì •
resilience4j:
  circuitbreaker:
    instances:
      redisLock:
        slidingWindowSize: 20
        failureRateThreshold: 60
        waitDurationInOpenState: 30s
        minimumNumberOfCalls: 5
        permittedNumberOfCallsInHalfOpenState: 3
        registerHealthIndicator: true
      nexonApi:
        slidingWindowSize: 10
        failureRateThreshold: 50
        waitDurationInOpenState: 1s  # í…ŒìŠ¤íŠ¸: ë¹ ë¥¸ ë³µêµ¬
        minimumNumberOfCalls: 10  # Issue #202: í…ŒìŠ¤íŠ¸ ê°„ CircuitBreaker ê²©ë¦¬ (3ë²ˆ retryë¡œ ì—´ë¦¬ì§€ ì•Šë„ë¡)
        registerHealthIndicator: true

  # Issue #202: í…ŒìŠ¤íŠ¸ í™˜ê²½ Retry ì„¤ì • (ìš´ì˜ 500ms â†’ í…ŒìŠ¤íŠ¸ 50ms)
  retry:
    instances:
      nexonApi:
        maxAttempts: 3
        waitDuration: 50ms  # í…ŒìŠ¤íŠ¸ í™˜ê²½: ë¹ ë¥¸ ì¬ì‹œë„
        retryExceptions:
          - java.util.concurrent.TimeoutException
          - maple.expectation.global.error.exception.ExternalServiceException

  # Issue #202: í…ŒìŠ¤íŠ¸ í™˜ê²½ TimeLimiter ì„¤ì •
  timelimiter:
    instances:
      nexonApi:
        timeoutDuration: 5s  # í…ŒìŠ¤íŠ¸ í™˜ê²½: ì§§ì€ íƒ€ì„ì•„ì›ƒ
        cancelRunningFuture: true

logging:
  level:
    root: info
    maple.expectation: debug
    org.springframework.test: info

nexon:
  api:
    key: dummy-test-key # Codex Botì´ ì§€ì í•œ @Value ì£¼ì… ì‹¤íŒ¨ í•´ê²°

# DP ì—”ì§„ í…Œì´ë¸” ê²€ì¦ ì„¤ì •
cube:
  table-mass:
    policy: LENIENT  # í…ŒìŠ¤íŠ¸ í™˜ê²½: í™•ë¥  í…Œì´ë¸” ì •ê·œí™” í—ˆìš©

# Rate Limiting ì„¤ì • (Issue #152)
ratelimit:
  enabled: true
  failure-mode: fail-open
  key-prefix: "{ratelimit}"
  ip:
    enabled: true
    capacity: 100
    window: 1m
    refill-tokens: 10
    refill-period: 6s
  user:
    enabled: true
    capacity: 200
    window: 1m
    refill-tokens: 20
    refill-period: 6s

# Auth ì„¤ì • (í…ŒìŠ¤íŠ¸ìš©)
auth:
  jwt:
    secret: test-jwt-secret-key-for-unit-tests-32chars
    expiration: 900  # 15ë¶„ (Issue #279)
  refresh-token:
    expiration: 604800  # 7ì¼ (Issue #279)
  fingerprint:
    secret: test-fingerprint-secret-key-32chars123
  admin:
    allowlist:
  session:
    ttl: 1800

# CORS ì„¤ì • (í…ŒìŠ¤íŠ¸ìš©)
cors:
  allowed-origins:
    - "http://localhost:3000"
  allow-credentials: true
  max-age: 3600