spring:
  config:
    activate:
      on-profile: ci

  datasource:
    url: jdbc:mysql://localhost:3306/${DB_SCHEMA_NAME:maple_test}?serverTimezone=Asia/Seoul&characterEncoding=UTF-8&rewriteBatchedStatements=true
    username: root
    password: ${DB_ROOT_PASSWORD:testpassword}

    hikari:
      maximum-pool-size: 10
      minimum-idle: 5

  jpa:
    hibernate:
      ddl-auto: create-drop  # CI에서는 매번 새로 생성

  # Redis 단일 모드 (CI 환경용 - Sentinel 미사용)
  data:
    redis:
      host: localhost
      port: 6379

alert:
  discord:
    webhook-url: ${ALERT_DISCORD_WEBHOOK_URL:}

# DP 엔진 테이블 검증 설정
cube:
  table-mass:
    policy: LENIENT  # CI 환경: 확률 테이블 정규화 허용

# CORS 설정 (CI 환경)
cors:
  allowed-origins:
    - "http://localhost:8080"

# ADR-0345: Resilience4j Configuration for Stateless Alert System
resilience4j:
  circuitbreaker:
    instances:
      discordWebhook:
        slidingWindowSize: 10
        failureRateThreshold: 50
        waitDurationInOpenState: 30s
        minimumNumberOfCalls: 5
        registerHealthIndicator: true
  retry:
    instances:
      discordWebhook:
        maxAttempts: 3
        waitDuration: 500ms
        exponentialBackoffMultiplier: 2.0
        retryExceptions:
          - org.springframework.web.reactive.function.client.WebClientRequestException
          - io.netty.channel.ConnectTimeoutException
  timelimiter:
    instances:
      discordWebhook:
        timeoutDuration: 5s
