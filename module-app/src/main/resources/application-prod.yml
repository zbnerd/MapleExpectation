# application-prod.yml

spring:
  config:
    activate:
      on-profile: prod

  datasource:
    url: ${DB_URL}
    username: ${DB_USER}
    password: ${DB_PASSWORD}

    hikari:
      maximum-pool-size: 50
      minimum-idle: 50

  jpa:
    hibernate:
      ddl-auto: update

  # Redis Standalone 설정 (운영 환경)
  data:
    redis:
      host: localhost
      port: 6379

discord:
  webhook-url: ${DISCORD_WEBHOOK_URL}

# CORS 설정 (Issue #172: 프로덕션 환경)
# CRITICAL: CORS_ALLOWED_ORIGINS 환경변수 미설정 시 앱 시작 실패 (fail-fast)
cors:
  allowed-origins: ${CORS_ALLOWED_ORIGINS}  # 필수 환경변수 (예: https://example.com,https://www.example.com)
  max-age: 86400  # 24시간 (프로덕션에서는 캐시 시간 늘림)

cube:
  table-mass:
    policy: LENIENT

# V5 Stateless Architecture (#271)
app:
  buffer:
    redis:
      enabled: true  # Scale-out 모드 활성화

# Issue #284 DoD: Redis 장애 시 1000 RPS fallback 용량
# NOTE: Main Pool(50) + Lock Pool(50) = 100 total (RDS max_connections 고려)
lock:
  datasource:
    pool-size: 50

# Thread Pool 최적화 (P1-7: t3.small 2vCPU 기준)
executor:
  equipment:
    core-pool-size: 16
    max-pool-size: 32
    queue-capacity: 500
  preset:
    core-pool-size: 6     # CPU-bound: 2vCPU × 3
    max-pool-size: 12
    queue-capacity: 200

# Issue #278: Scale-out 환경 실시간 좋아요 동기화 (prod)
like:
  realtime:
    transport: rtopic  # 배포 후 reliable-topic으로 전환 (Blue-Green 배포 필수)

# #275 Auto Warmup: 프로덕션에서 활성화
scheduler:
  warmup:
    enabled: true           # 자동 웜업 활성화
    top-count: 100          # 상위 100개 캐릭터 웜업
    delay-between-ms: 50    # 프로덕션에서는 더 빠르게

# SpringDoc OpenAPI (Swagger UI) - 프로덕션에서 비활성화
springdoc:
  api-docs:
    enabled: false
  swagger-ui:
    enabled: false