# Issue #209: MySQL Slow Query Log Configuration
# Issue #208: InnoDB Buffer Pool Tuning
#
# 5-Agent Council 합의:
# - Red (Lead): 디스크 폭발 방지를 위한 throttle 설정
# - Green: Buffer Pool 60% 할당, flush 최적화
# - Purple: 민감 정보 제한 (log_slow_extra 비활성화)

[mysqld]
# ============================================
# InnoDB Buffer Pool 튜닝 (#208)
# ============================================
# t3.small (2GB RAM) 기준 60% 할당
# - 기본값: 128MB → 1200MB로 증가
# - Buffer Pool Hit Rate > 99% 목표
innodb_buffer_pool_size = 1200M

# 단일 인스턴스 (2GB 미만은 분할 불필요)
innodb_buffer_pool_instances = 1

# Log Buffer: 트랜잭션 처리 효율화
innodb_log_buffer_size = 16M

# Flush 정책: 성능/안정성 균형
# - 0: 1초마다 flush (빠름, 1초 데이터 손실 가능)
# - 1: 매 커밋마다 flush (느림, ACID 보장)
# - 2: 커밋 시 OS 버퍼까지만 flush (균형)
innodb_flush_log_at_trx_commit = 2

# Direct I/O: 이중 버퍼링 방지
innodb_flush_method = O_DIRECT

# ============================================
# Slow Query Log 기본 설정 (#209)
# ============================================
slow_query_log = 1
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 1

# ============================================
# 인덱스 미사용 쿼리 감지
# ============================================
# 인덱스를 사용하지 않는 쿼리 기록
log_queries_not_using_indexes = 1

# 분당 최대 10개로 제한 (디스크 폭발 방지 - Green 승인)
log_throttle_queries_not_using_indexes = 10

# ============================================
# 보안 설정 (Purple 승인)
# ============================================
# 추가 정보 기록 비활성화 (민감 정보 보호)
log_slow_extra = 0
