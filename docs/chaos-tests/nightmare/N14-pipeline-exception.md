# Nightmare 14: Pipeline Blackhole (예외 삼킴)

> **담당 에이전트**: 🔴 Red (장애주입) & 🔵 Blue (아키텍처)
> **난이도**: P1 (High)
> **예상 결과**: CONDITIONAL PASS

---

## 0. 최신 테스트 결과 (2025-01-20)

### ❌ FAIL (1/5 테스트 실패)

| 테스트 메서드 | 결과 | 설명 |
|-------------|------|------|
| `shouldSwallowException_withExecuteOrDefault()` | ✅ PASS | executeOrDefault 예외 삼킴 동작 확인 |
| `shouldLogException_withExecuteOrDefault()` | ✅ PASS | 예외 로그 기록 확인 |
| `shouldThrowException_withExecuteOrCatch()` | ✅ PASS | executeOrCatch 복구 로직 동작 |
| `shouldVerifyUsagePattern_inCodebase()` | ✅ PASS | 코드베이스 사용 패턴 검증 |
| `shouldPropagateException_withExecute()` | ❌ FAIL | execute 패턴 예외 전파 실패 |

### 🔴 문제 원인
- **execute 패턴 동작**: 예외 전파 시 예상과 다른 동작 발생
- **LogicExecutor 구현**: execute()가 예외를 그대로 전파하지 않을 가능성
- **영향**: 비즈니스 크리티컬 작업에서 Silent Failure 위험

### 📋 Issue Required
**[P1] LogicExecutor.execute() 예외 전파 동작 검증 필요**

---

## 1. 테스트 전략 (🟡 Yellow's Plan)

### 목적
LogicExecutor.executeOrDefault 패턴이 예외를 삼켜서
디버깅이 불가능해지는 "Silent Failure" 문제를 검증한다.

### 검증 포인트
- [ ] executeOrDefault 예외 삼킴 동작
- [ ] execute 예외 전파 동작
- [ ] executeOrCatch 복구 로직 동작
- [ ] 비즈니스 크리티컬 작업에서의 위험성

### 성공 기준
- 예외 발생 시 로그에 기록됨
- 조회 로직에서만 executeOrDefault 사용

---

## 2. 위험한 패턴 (🔴 Red's Analysis)

### executeOrDefault의 함정
```java
// 위험: 결제 로직에 executeOrDefault 사용
Boolean paymentSuccess = executor.executeOrDefault(
    () -> paymentGateway.process(order),  // 예외 발생!
    false,  // 기본값 반환
    context
);

// 문제: false가 반환되지만...
// - 의도적인 결제 거절인가?
// - 시스템 장애인가?
// 구분 불가능!
```

### 올바른 사용
```java
// 조회 로직: executeOrDefault OK
User user = executor.executeOrDefault(
    () -> userRepository.findById(id),
    null,
    context
);

// 비즈니스 로직: execute 사용
void processPayment(Order order) {
    executor.execute(  // 예외 전파
        () -> paymentGateway.process(order),
        context
    );
}
```

---

## 3. LogicExecutor 패턴 가이드

| 패턴 | 메서드 | 용도 |
|------|--------|------|
| 예외 전파 | `execute()` | 비즈니스 로직 |
| 기본값 반환 | `executeOrDefault()` | 조회 로직 (null OK) |
| 커스텀 복구 | `executeOrCatch()` | 복구 로직 필요 시 |
| finally 보장 | `executeWithFinally()` | 자원 해제 |
| 예외 변환 | `executeWithTranslation()` | 도메인 예외로 변환 |

---

## 4. 이슈 정의 (실패 시)

### 📌 문제 정의
executeOrDefault가 비즈니스 크리티컬 작업에 사용되어 예외 삼킴.

### ✅ Action Items
- [ ] 코드베이스에서 executeOrDefault 사용처 검토
- [ ] mutation 로직에서 execute/executeOrCatch로 변경
- [ ] 코드 리뷰 체크리스트에 추가

---

## 5. 최종 판정 (🟡 Yellow's Verdict)

### 결과: **FAIL**

`execute()` 패턴에서 예외 전파 시 **메시지 변환 문제** 발생.
원본 예외 메시지("propagate")가 InternalSystemException으로 래핑되어 손실.

### 기술적 인사이트
- **ExceptionTranslator 동작**: 모든 예외가 InternalSystemException으로 변환됨
- **메시지 손실**: 원본 예외 메시지 대신 일반 오류 메시지로 대체
- **Exception Chaining 유지**: cause 체인은 유지되나 메시지 접근성 저하
- **디버깅 가시성 감소**: 로그에서 원인 파악 어려움

### 권장 개선 사항
1. **ExceptionTranslator 개선**: 원본 메시지 포함 옵션 추가
2. **테스트 수정**: cause 체인에서 원본 메시지 확인으로 변경
3. **로깅 강화**: 예외 발생 시 원본 메시지도 함께 로깅
4. **코드 리뷰**: executeOrDefault 사용처 중 mutation 로직 점검

---

*Generated by 5-Agent Council*
