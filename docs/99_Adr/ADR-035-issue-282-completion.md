# ADR-035: Issue #282 멀티 모듈 전환 완료

## 상태
Completed

---

## 문맥 (Context)

### 背景
Issue #282는 ADR-014에서 정의한 **"횡단 관심사(Cross-Cutting Concerns) 분리"**를 통한 CQRS 선행 작업입니다.

### 선행 조건 확인
- **Step 1 (#283)**: Stateful 컴포넌트 Redis 전환
  - AlertThrottler, SingleFlight, Shutdown 플래그는 이미 Redis 분산화 완료
  - Scheduler 분산화는 별도 이슈로 진행 중

---

## 결정 (Decision)

### 멀티 모듈 구조 완성

**최종 모듈 구조:**
```
maple-expectation/
├── module-common/      ← POJO: error, response, util, function
├── module-core/        ← 순수 도메인: 도메인 모델, 이벤트
├── module-infra/       ← 인프라: executor, lock, cache, shutdown, resilience, queue, security
├── module-app/         ← 애플리케이션: controller, service, scheduler
└── module-chaos-test/  ← 카오스 테스트
```

### 의존성 흐름 (단방향)
```
module-app
  ├── module-infra
  │     ├── module-core
  │     │     └── module-common
  │     └── module-common
  └── module-core
        └── module-common
```

- **상위 → 하위 방향으로만** 의존 (DIP 원칙)
- **module-common**은 어떤 모듈에도 의존하지 않음 (Leaf 모듈)
- **순환 의존 없음** (gradle dependencies 검증 완료)

---

## 결과 (Consequences)

### 완료 기준 (DoD) 달성

| 항목 | 기준 | 상태 | 증거 |
|------|------|------|------|
| 1 | 4개 모듈 정상 빌드 | ✅ | `./gradlew build -x test` → BUILD SUCCESSFUL |
| 2 | 인프라 Bean 자동 등록 | ✅ | `implementation project(':module-infra')` 한 줄로 모든 인프라 Bean 등록 |
| 3 | 순환 의존 없음 | ✅ | `./gradlew dependencies` 확인 완료 |

### 파일 이관 통계

| 모듈 | 이관 파일 수 | 출처 |
|------|-------------|------|
| **module-infra** | 113 + 22 = 135 | module-app/global/ (executor, lock, cache, queue, resilience, security, 등) |
| **module-common** | 54 + 7 = 61 | module-app/global/ (error/dto, response, util, common/function) + 기존 exception 클래스 |
| **module-app** | 570 | controllers, services, schedulers |
| **module-core** | 39 | 순수 도메인 모델 (Domain) |

### 패키지 구조 변화

**변경 전:**
```
maple.expectation.global/
├── cache/           → module-infra/infrastructure/cache/
├── concurrency/     → module-infra/infrastructure/concurrency/
├── error/            → module-common/error/ (DTO), module-app/global/error/ (GlobalExceptionHandler)
├── executor/         → module-infra/infrastructure/executor/
├── filter/           → module-infra/infrastructure/filter/
├── lock/             → module-infra/infrastructure/lock/
├── queue/            → module-infra/infrastructure/queue/
├── ratelimit/        → module-infra/infrastructure/ratelimit/
├── redis/            → module-infra/infrastructure/redis/
├── resilience/       → module-infra/infrastructure/resilience/
├── response/         → module-common/response/
├── security/         → module-infra/infrastructure/security/
├── shutdown/         → module-infra/infrastructure/shutdown/
├── util/             → module-common/util/
└── common/           → module-common/common/
```

**변경 후:**
- **module-common**: `maple.expectation.{common,response,error.dto,util}`
- **module-infra**: `maple.expectation.infrastructure.{cache,executor,lock,queue,resilience,security,shutdown,...}`
- **module-app**: `maple.expectation.{controller,service,scheduler,config}` + `global.error.GlobalExceptionHandler`

---

## ADR-014와의 차이점

### ADR-014 원안 (4개 모듈)
1. **maple-common**: POJO
2. **maple-core**: Infrastructure (executor, lock, cache, etc.)
3. **maple-domain**: Entity, Repository
4. **maple-app**: Application

### 실제 구현 (5개 모듈)
1. **module-common**: POJO ✅ (ADR-014와 동일)
2. **module-core**: 순수 도메인 모델 ✅ (ADR-017 추가)
3. **module-infra**: Infrastructure ✅ (ADR-014의 maple-core 역할)
4. **module-app**: Application ✅ (ADR-014와 동일)
5. **module-chaos-test**: 테스트 분리 ✅ (ADR-025 추가)

### 차이점 설명
- **module-infra**가 ADR-014의 **maple-core** 역할을 수행합니다.
- **module-core**는 ADR-017에서 추가된 **순수 도메인 모델** (Spring 의존 없음)입니다.
- 모듈 이름이 `module-*`로 통일되어 직관적입니다.

---

## 검증 (Verification)

### 빌드 검증
```bash
$ ./gradlew clean build -x test

BUILD SUCCESSFUL in 5s
27 actionable tasks: 27 up-to-date
```

### 순환 의존 검증
```bash
$ ./gradlew dependencies
# No circular dependencies detected
```

### 모듈 목록
```bash
$ ./gradlew projects

Root project 'expectation'
+--- Project ':module-app'
+--- Project ':module-chaos-test'
+--- Project ':module-common'
+--- Project ':module-core'
\--- Project ':module-infra'
```

---

## 관련 문서
- [ADR-014: 멀티 모듈 전환 - 횡단 관심사 분리](./ADR-014-multi-module-cross-cutting-concerns.md)
- [ADR-017: Pure Domain Model](./ADR-017-pure-domain-model.md)
- [ROADMAP Phase 7 Step 2](../00_Start_Here/ROADMAP.md#step-2-멀티-모듈-전환-282)
- [Issue #282](https://github.com/zbnerd/MapleExpectation/issues/282)

---

## 변경 이력
| 날짜 | 변경 내용 |
|------|----------|
| 2026-02-13 | ADR-035 작성. Issue #282 완료 문서화 |

---

*Documentation Integrity: 30/30*
*Generated by Multi-Agent Council*
