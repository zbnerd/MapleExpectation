# Nightmare 03: Thread Pool Exhaustion - í…ŒìŠ¤íŠ¸ ê²°ê³¼

> **ì‹¤í–‰ì¼**: 2026-01-19
> **ê²°ê³¼**: âŒ **FAIL** (1/2 í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨)

---

## í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½

| í…ŒìŠ¤íŠ¸ | ê²°ê³¼ | ì„¤ëª… |
|--------|------|------|
| CallerRunsPolicy ë©”ì¸ ìŠ¤ë ˆë“œ ë¸”ë¡œí‚¹ | âŒ FAIL | 2010ms ë¸”ë¡œí‚¹ ë°œìƒ |
| AbortPolicy RejectedExecutionException | âœ… PASS | ì˜ˆì™¸ ì •ìƒ ë°œìƒ |

---

## ìƒì„¸ ê²°ê³¼

### Test 1: CallerRunsPolicyë¡œ ì¸í•œ ë©”ì¸ ìŠ¤ë ˆë“œ ë¸”ë¡œí‚¹ ê²€ì¦ âŒ
```
Nightmare 03: Thread Pool Exhaustion > CallerRunsPolicyë¡œ ì¸í•œ ë©”ì¸ ìŠ¤ë ˆë“œ ë¸”ë¡œí‚¹ ê²€ì¦ FAILED
    java.lang.AssertionError: [[Nightmare] ì‘ì—… ì œì¶œì€ ë©”ì¸ ìŠ¤ë ˆë“œë¥¼ ë¸”ë¡œí‚¹í•˜ì§€ ì•Šì•„ì•¼ í•¨ (â‰¤100ms)]
    Expecting actual:
      2010L
    to be less than or equal to:
      100L
```

**ë¶„ì„**:
- Thread Pool ì„¤ì •: core=2, max=2, queue=2 (ì´ ìš©ëŸ‰ 4)
- ì œì¶œëœ ì‘ì—…: 60ê°œ (ìš©ëŸ‰ì˜ 15ë°°)
- CallerRunsPolicy ë°œë™: 56ê°œ ì‘ì—…ì´ ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰
- **ê²°ê³¼**: ë©”ì¸ ìŠ¤ë ˆë“œ 2010ms ë¸”ë¡œí‚¹ â†’ API ì‘ë‹µ ë¶ˆê°€ ìƒíƒœ

### Test 2: AbortPolicy ì‚¬ìš© ì‹œ RejectedExecutionException ë°œìƒ âœ…
```
Nightmare 03: Thread Pool Exhaustion > AbortPolicy ì‚¬ìš© ì‹œ RejectedExecutionException ë°œìƒ PASSED
```

**ë¶„ì„**:
- AbortPolicyëŠ” Pool í¬í™” ì‹œ `RejectedExecutionException` ë°œìƒ
- ë¹ ë¥¸ ì‹¤íŒ¨(Fail-Fast)ë¡œ ë©”ì¸ ìŠ¤ë ˆë“œ ë¸”ë¡œí‚¹ ë°©ì§€
- ì˜ˆì™¸ ì²˜ë¦¬ ë¡œì§ì—ì„œ Fallback ê°€ëŠ¥

---

## ê·¼ë³¸ ì›ì¸ ë¶„ì„

### Thread Pool ë™ì‘ íë¦„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ThreadPoolTaskExecutor            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì‘ì—… ì œì¶œ ìˆœì„œ:                              â”‚
â”‚ 1. corePoolSizeê¹Œì§€ ìŠ¤ë ˆë“œ ìƒì„± (2ê°œ)        â”‚
â”‚ 2. íì— ëŒ€ê¸° (2ê°œ)                          â”‚
â”‚ 3. maxPoolSizeê¹Œì§€ ì¶”ê°€ ìƒì„± (ì´ë¯¸ max)      â”‚
â”‚ 4. RejectedExecutionHandler ë°œë™!           â”‚
â”‚    â†’ CallerRunsPolicy: ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CallerRunsPolicyì˜ ë¬¸ì œì 
```
Main Thread: submit(task5) â†’ CallerRunsPolicy â†’ task5 ì‹¤í–‰ (5ì´ˆ)
                                                    â†“
                                          ë©”ì¸ ìŠ¤ë ˆë“œ ë¸”ë¡œí‚¹!
                                                    â†“
                                          API ì‘ë‹µ ë¶ˆê°€
```

---

## ì˜í–¥ë„ ë¶„ì„

| í•­ëª© | ì˜í–¥ | ì„¤ëª… |
|------|------|------|
| ì‚¬ìš©ì ê²½í—˜ | ğŸ”´ High | API ì‘ë‹µ ì§€ì—°/íƒ€ì„ì•„ì›ƒ |
| ì‹œìŠ¤í…œ ì•ˆì •ì„± | ğŸŸ¡ Medium | ë©”ì¸ ìŠ¤ë ˆë“œ ë¸”ë¡œí‚¹ìœ¼ë¡œ ì „ì²´ ì²˜ë¦¬ëŸ‰ ì €í•˜ |
| ë°ì´í„° ë¬´ê²°ì„± | ğŸŸ¢ Low | ì‘ì—… ì†ì‹¤ ì—†ìŒ (ë¸”ë¡œí‚¹ë§Œ ë°œìƒ) |

---

## RejectedExecutionHandler ì •ì±… ë¹„êµ

| ì •ì±… | ë™ì‘ | ë©”ì¸ ìŠ¤ë ˆë“œ | ì‘ì—… ì†ì‹¤ | ê¶Œì¥ ìƒí™© |
|------|------|------------|----------|----------|
| **CallerRunsPolicy** | í˜¸ì¶œìì—ì„œ ì‹¤í–‰ | âŒ ë¸”ë¡œí‚¹ | âœ… ì—†ìŒ | ì‘ì—… ì†ì‹¤ ë¶ˆê°€ ì‹œ |
| **AbortPolicy** | ì˜ˆì™¸ ë°œìƒ | âœ… ë¹„ë¸”ë¡œí‚¹ | âš ï¸ ê°€ëŠ¥ | Fallback ìˆì„ ë•Œ |
| **DiscardPolicy** | ì¡°ìš©íˆ ë²„ë¦¼ | âœ… ë¹„ë¸”ë¡œí‚¹ | âŒ ì†ì‹¤ | ë¹„ê¶Œì¥ |
| **DiscardOldestPolicy** | ì˜¤ë˜ëœ ê²ƒ ë²„ë¦¼ | âœ… ë¹„ë¸”ë¡œí‚¹ | âŒ ì†ì‹¤ | ìµœì‹  ìš°ì„  ì‹œ |

---

## í•´ê²° ë°©ì•ˆ

### ë‹¨ê¸° (Hotfix)
```java
// Pool í¬ê¸° ì¦ê°€ (Little's Law ê¸°ë°˜)
@Bean("asyncExecutor")
public ThreadPoolTaskExecutor asyncExecutor() {
    ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
    executor.setCorePoolSize(10);       // 2 â†’ 10
    executor.setMaxPoolSize(50);        // 2 â†’ 50
    executor.setQueueCapacity(100);     // 2 â†’ 100
    return executor;
}
```

### ì¥ê¸° (ê·¼ë³¸ í•´ê²°)
```java
// Resilience4j Bulkhead íŒ¨í„´ ì ìš©
@Bulkhead(name = "asyncService",
          type = Bulkhead.Type.THREADPOOL,
          fallbackMethod = "fallback")
public CompletableFuture<String> asyncMethod() {
    return CompletableFuture.supplyAsync(() -> {
        // ë¹„ë™ê¸° ì‘ì—…
    }, asyncExecutor);
}

// Fallback ë©”ì„œë“œ
public CompletableFuture<String> fallback(Throwable t) {
    log.warn("Bulkhead fallback triggered: {}", t.getMessage());
    return CompletableFuture.completedFuture("Fallback Response");
}
```

---

## ìƒì„±ëœ ì´ìŠˆ

- **Priority**: P1 (High)
- **Title**: [P1][Nightmare-03] CallerRunsPolicyë¡œ ì¸í•œ ë©”ì¸ ìŠ¤ë ˆë“œ ë¸”ë¡œí‚¹ ë°œìƒ

---

*Generated by 5-Agent Council - Nightmare Chaos Test*
