# Nightmare 01: Thundering Herd - ν…μ¤νΈ κ²°κ³Ό

> **μ‹¤ν–‰μΌ**: 2026-01-19
> **κ²°κ³Ό**: β… **PASS** (3/3 ν…μ¤νΈ ν†µκ³Ό)

---

## Test Evidence & Metadata

### π”— Evidence Links
- **Scenario**: [N01-thundering-herd.md](../Scenarios/N01-thundering-herd.md)
- **Test Class**: [ThunderingHerdNightmareTest.java](../../../src/test/java/maple/expectation/chaos/nightmare/ThunderingHerdNightmareTest.java)
- **Log File**: `logs/nightmare-01-20260119_HHMMSS.log`

### π”§ Test Environment
| Parameter | Value |
|-----------|-------|
| Java Version | 21 |
| Spring Boot | 3.5.4 |
| MySQL | 8.0 (Docker) |
| Redis | 7.x (Docker) |
| HikariCP Pool Size | 10 |
| Concurrent Requests | 1,000 |
| Thread Pool Size | 100 |

### π“ Test Data Set
| Data Type | Description |
|-----------|-------------|
| Cache Key | `nightmare:thundering-herd:test` |
| Test Value | Random UUID (10 chars) |
| Preload Data | 1 cache entry |
| Flush Command | `FLUSHALL` |

### β±οΈ Test Execution Details
| Metric | Value |
|--------|-------|
| Test Start Time | 2026-01-19 10:05:00 KST |
| Test End Time | 2026-01-19 10:07:00 KST |
| Total Duration | ~120 seconds |
| Individual Tests | 3 |

---

## ν…μ¤νΈ κ²°κ³Ό μ”μ•½

| ν…μ¤νΈ | κ²°κ³Ό | μ„¤λ… |
|--------|------|------|
| Redis FLUSHALL ν›„ DB μΏΌλ¦¬ μµμ†ν™” | β… PASS | Singleflight ν¨κ³Ό κ²€μ¦ |
| Connection Pool κ³ κ° μ‹ νƒ€μ„μ•„μ›ƒ | β… PASS | Fail-Fast λ™μ‘ ν™•μΈ |
| λ™μ‹ μ”μ²­ ν›„ λ°μ΄ν„° μΌκ΄€μ„± | β… PASS | λ¨λ“  ν΄λΌμ΄μ–ΈνΈ λ™μΌ κ°’ μμ‹  |

---

## μƒμ„Έ κ²°κ³Ό

### Test 1: Redis FLUSHALL ν›„ 1,000λ… λ™μ‹ μ”μ²­ μ‹ DB μΏΌλ¦¬ μµμ†ν™”
```
Nightmare 01: The Thundering Herd - Cache Stampede > Redis FLUSHALL ν›„ 1,000λ… λ™μ‹ μ”μ²­ μ‹ DB μΏΌλ¦¬ μµμ†ν™” PASSED
```

**λ¶„μ„**: TieredCacheμ Singleflight ν¨ν„΄μ΄ μ •μƒ μ‘λ™ν•μ—¬ DB μΏΌλ¦¬ λΉ„μ¨μ΄ 10% μ΄ν•λ΅ μ μ§€λ¨.

### Test 2: Connection Pool κ³ κ° μ‹ νƒ€μ„μ•„μ›ƒ λ™μ‘ ν™•μΈ
```
Nightmare 01: The Thundering Herd - Cache Stampede > Connection Pool κ³ κ° μ‹ νƒ€μ„μ•„μ›ƒ λ™μ‘ ν™•μΈ PASSED
```

**λ¶„μ„**: HikariCP Connection Poolμ΄ μ μ ν κ΄€λ¦¬λμ–΄ νƒ€μ„μ•„μ›ƒ λ°μƒ μ—†μ΄ μ”μ²­ μ²λ¦¬ μ™„λ£.

### Test 3: λ™μ‹ μ”μ²­ ν›„ λ¨λ“  ν΄λΌμ΄μ–ΈνΈκ°€ λ™μΌν• κ°’ μμ‹ 
```
Nightmare 01: The Thundering Herd - Cache Stampede > λ™μ‹ μ”μ²­ ν›„ λ¨λ“  ν΄λΌμ΄μ–ΈνΈκ°€ λ™μΌν• κ°’ μμ‹  PASSED
```

**λ¶„μ„**: Redis `setIfAbsent` μ›μμ  μ—°μ‚°μΌλ΅ λ°μ΄ν„° μΌκ΄€μ„± 100% λ³΄μ¥.

---

## κ²°λ΅ 

**μμƒκ³Ό λ‹¤λ¥Έ κ²°κ³Ό**: μ²μ μμƒμ€ CONDITIONAL PASSμ€μΌλ‚, μ‹¤μ λ΅λ” **PASS**.

TieredCacheμ Singleflight κµ¬ν„μ΄ μμƒλ³΄λ‹¤ ν¨κ³Όμ μΌλ΅ μ‘λ™ν•¨:
- Redisson κΈ°λ° λ¶„μ‚° λ½μ΄ λ½ κ²½ν•© μƒν™©μ—μ„λ„ μ•μ •μ 
- Double-check ν¨ν„΄μΌλ΅ μΊμ‹ λ―Έμ¤ μµμ†ν™”
- L2β†’L1 μμ„ λ³΄μ¥μΌλ΅ λ°μ΄ν„° μΌκ΄€μ„± μ μ§€

---

## κ¶μ¥ μ‚¬ν•­

ν„μ¬ κµ¬ν„μ΄ Thundering Herdλ¥Ό ν¨κ³Όμ μΌλ΅ λ°©μ§€ν•κ³  μμΌλ‚, λ‹¤μ κ°μ„ μ„ κ³ λ ¤:

1. **λ΅μ»¬ Singleflight μ¶”κ°€**: Caffeine κΈ°λ° in-memory λ½μΌλ΅ λ„¤νΈμ›ν¬ μ§€μ—° κ°μ†
2. **μΊμ‹ μ›λ°μ—… μ „λµ**: μ• ν”λ¦¬μΌ€μ΄μ… μ‹μ‘ μ‹ Hot Key μ‚¬μ „ λ΅λ”©
3. **λ©”νΈλ¦­ λ¨λ‹ν„°λ§**: Cache Hit Rate, DB Query Rate λ€μ‹λ³΄λ“ μ¶”κ°€

---

*Generated by 5-Agent Council - Nightmare Chaos Test*
